(function(e){function t(t){for(var n,o,a=t[0],c=t[1],l=t[2],f=0,d=[];f<a.length;f++)o=a[f],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(d.length)d.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],n=!0,a=1;a<i.length;a++){var c=i[a];0!==r[c]&&(n=!1)}n&&(s.splice(t--,1),e=o(o.s=i[0]))}return e}var n={},r={main:0},s=[];function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/zuweiser/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;s.push(["8dc6","chunk-vendors"]),i()})({0:function(e,t){},1:function(e,t){},2:function(e,t){},"4b9e":function(e,t,i){},"649d":function(e,t,i){},"650d":function(e,t,i){"use strict";var n=i("4b9e"),r=i.n(n);r.a},"7d00":function(e,t,i){"use strict";var n=i("649d"),r=i.n(n);r.a},"8dac":function(e,t,i){},"8dc6":function(e,t,i){"use strict";i.r(t);var n=i("2b0e"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("h1",[e._v("Zuweiser")]),i("am-excel-reader",{on:{"excel-overview-loaded":e.onOverviewLoaded}}),e.excelOverview?i("div",{attrs:{id:"sheet-config"}},[i("h2",{attrs:{id:"config-header"}},[e._v("Blätter & Spalten auswählen")]),i("am-activities-sheet-config",{attrs:{id:"config-activities","excel-overview":e.excelOverview},on:{completed:e.activitiesConfigCompleted}}),i("am-participants-sheet-config",{attrs:{id:"config-participants","excel-overview":e.excelOverview},on:{completed:e.participantsConfigCompleted}})],1):e._e(),i("am-do-matching",{attrs:{config:e.matchConfig},on:{matched:e.onMatched}}),i("am-result-printer",{attrs:{result:e.result}})],1)},s=[],o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("h3",[e._v("Aktivitäten")]),i("h4",[e._v("Arbeitsblatt")]),i("am-multiselect",{attrs:{values:Object.keys(e.excelOverview.sheets)},on:{input:e.onChange},model:{value:e.activitiesConfig.worksheet,callback:function(t){e.$set(e.activitiesConfig,"worksheet",t)},expression:"activitiesConfig.worksheet"}}),e.activitiesConfig.worksheet?[i("h4",[e._v("Spalten")]),e._l(e.activitiesConfig.fields,(function(t,n){return i("am-multiselect",{key:t.id,attrs:{values:e.excelOverview.sheets[e.activitiesConfig.worksheet],label:e.labels[n]},on:{input:e.onChange},model:{value:e.activitiesConfig.fields[n],callback:function(t){e.$set(e.activitiesConfig.fields,n,t)},expression:"activitiesConfig.fields[key]"}})}))]:e._e()],2)},a=[],c={props:["excelOverview"],data(){return{activitiesConfig:{worksheet:"",fields:{id:"",name:"",limit:""}},labels:{worksheet:"Arbeitsblatt",id:"ID",name:"Kursname",limit:"Teilnehmerlimite"}}},methods:{onChange(){this.activitiesConfig.worksheet&&this.$emit("completed",this.activitiesConfig)}}},l=c,u=i("2877"),f=Object(u["a"])(l,o,a,!1,null,"60263434",null),d=f.exports,h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("h2",[e._v("Datei angeben")]),i("label",{attrs:{for:"file"}}),i("input",{attrs:{type:"file",id:"file"},on:{change:e.loadExcel}}),e._t("default")],2)},p=[],v=i("f560"),m=i.n(v),g=i("1146"),_=i.n(g);function b(e,t){var i=e.Sheets[t];w(i);return y(i)}function w(e){var t=_.a.utils.sheet_to_json(e);return Object.keys(t[0])}function y(e){return _.a.utils.sheet_to_json(e)}function C(e){var t=new FileReader,i=new Promise((function(e,i){t.onload=function(t){var n=t.target.result;try{var r=_.a.read(n,{type:"binary"});e(r)}catch(t){i(t)}}}));return t.readAsBinaryString(e),i}function k(e){for(var t={},i=0,n=e.SheetNames;i<n.length;i++){var r=n[i],s=_.a.utils.sheet_to_json(e.Sheets[r]);t[r]=Object.keys(s[0])}return{sheets:t}}var O=i("020f"),x=i.n(O),P=i("6747"),S=i.n(P),j=i("e2a0"),$=i.n(j),A=function(){function e(e){this.courseData=e,this.students=[],this.shadows=[]}return Object.defineProperty(e.prototype,"id",{get:function(){return this.courseData.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"limit",{get:function(){return this.courseData.limit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.courseData.name},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name},e}(),E=function(){function e(e){this.studentData=e,this.matched=!1}return Object.defineProperty(e.prototype,"id",{get:function(){return this.studentData.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priorities",{get:function(){return this.studentData.priorities},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.studentData.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstName",{get:function(){return this.studentData.firstName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"class",{get:function(){return this.studentData.class},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.firstName+" "+this.name},e}();function N(e,t){var i={};return x()(t,(function(t,n){$()(t)?i[n]=e[t]:S()(t)&&(i[n]=[],x()(t,(function(t,r){i[n].push(e[t.column])})))})),i}function D(e,t){var i=N(e,t);return new E(i)}function M(e,t){var i=N(e,t);return new A(i)}var T=i("9ab4"),V=i("2769"),z=i.n(V),B=i("eed6"),R=i.n(B),F=function(e){function t(i,n,r){void 0===r&&(r={});var s=e.call(this,n+" not unique for entity "+i)||this;return Object.setPrototypeOf(s,t.prototype),s.entityType=i,s.propertyName=n,s.entity=r,s}return Object(T["a"])(t,e),t}(Error),L=function(e){function t(i,n,r){void 0===r&&(r={});var s=e.call(this,i+" with id="+n+" does not exist. Referred to by "+r+".")||this;return Object.setPrototypeOf(s,t.prototype),s.entityType=i,s.id=n,s.referrer=r,s}return Object(T["a"])(t,e),t}(Error);function I(e){var t=e.students,i=e.courses;W(i),K(t),U(t,i),J(t);var n=0,r=t[0].priorities.length;while(n<r)t.forEach((function(e){var t=e.priorities[n],r=z()(i,(function(e){return e.id===t})),s=r.students.length<r.limit;!e.matched&&s?(r.students.push(e),e.matched=!0):r.shadows.push({student:e,wasCourseFull:!s,wasAlreadyMatched:e.matched,priority:n+1})})),n+=1;return{students:t,courses:i}}function K(e){var t=new Set;e.forEach((function(e){if(t.has(e.id))throw new F("Participant","id",new E({}));t.add(e.id)}))}function W(e){var t=new Set;e.forEach((function(e){if(t.has(e.id))throw new F("Activity","id",new A({}));t.add(e.id)}))}function J(e){e.forEach((function(e){var t=e.priorities.length,i=R()(e.priorities).length;if(t!==i)throw new F("Participant","priorities",e)}))}function U(e,t){var i=t.map((function(e){return e.id}));e.forEach((function(e){e.priorities.forEach((function(t){if(!z()(i,(function(e){return e===t})))throw new L("Activity",t,e)}))}))}function q(e){var t=e.workbook,i=e.config,n=b(t,i.courses.worksheet),r=n.map((function(e){return M(e,i.courses.fields)}));return{courses:r,workbook:t,config:i}}function G(e){var t=e.workbook,i=e.courses,n=e.config,r=b(t,n.student.worksheet),s=r.map((function(e){return D(e,n.student.fields)})),o=m()(s);return{workbook:t,students:o,courses:i,config:n}}var Z={data(){return{filename:"",error:{message:""}}},methods:{loadExcel(e){const t=e.target.files[0];C(t).then(k).then(e=>(e.filename=t,e)).then(e=>this.$emit("excel-overview-loaded",e)).catch(e=>this.error.message=e.toString())}}},H=Z,Q=Object(u["a"])(H,h,p,!1,null,null,null),X=Q.exports,Y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("h3",[e._v("Teilnehmer")]),i("h4",[e._v("Arbeitsblatt")]),i("am-multiselect",{attrs:{values:Object.keys(e.excelOverview.sheets)},on:{input:e.onChange},model:{value:e.participantsConfig.worksheet,callback:function(t){e.$set(e.participantsConfig,"worksheet",t)},expression:"participantsConfig.worksheet"}}),e.participantsConfig.worksheet?[i("h4",[e._v("Spalten")]),e._l(e.notPriorities(e.participantsConfig.fields),(function(t,n){return i("am-multiselect",{key:t.id,attrs:{values:e.excelOverview.sheets[e.participantsConfig.worksheet],label:e.labels[n]},on:{input:e.onChange},model:{value:e.participantsConfig.fields[n],callback:function(t){e.$set(e.participantsConfig.fields,n,t)},expression:"participantsConfig.fields[key]"}})})),e._l(e.participantsConfig.fields.priorities,(function(t,n){return i("div",[i("label",[e._v(e._s(n+1+". "+e.labels["priorities"]))]),i("select",{directives:[{name:"model",rawName:"v-model",value:e.participantsConfig.fields.priorities[n].column,expression:"participantsConfig.fields.priorities[index].column"}],on:{input:e.onChange,change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.participantsConfig.fields.priorities[n],"column",t.target.multiple?i:i[0])}}},e._l(e.excelOverview.sheets[e.participantsConfig.worksheet],(function(t){return i("option",[e._v(" "+e._s(t)+" ")])})),0),i("button",{staticClass:"remove-priority",on:{click:function(t){return e.removePriority(n)}}},[e._v(" - ")])])})),i("button",{on:{click:function(t){return e.addPriority()}}},[e._v("Priorität hinzufügen")])]:e._e()],2)},ee=[],te=i("3eea"),ie=i.n(te),ne={props:["excelOverview"],data(){return{participantsConfig:{worksheet:"",fields:{id:"",name:"",firstName:"",class:"",priorities:[]}},labels:{worksheet:"Arbeitsblatt",id:"ID",name:"Name",firstName:"Vorname",class:"Klasse",priorities:"Priorität"}}},methods:{onChange(){this.participantsConfig.worksheet&&(this.participantsConfig.fields.priorities=this.populatePriorities(),this.$emit("completed",this.participantsConfig))},notPriorities(){return ie()(this.participantsConfig.fields,"priorities")},removePriority(e){this.participantsConfig.fields.priorities.splice(e,1)},addPriority(){this.participantsConfig.fields.priorities.push({column:null})},populatePriorities(){const e=this.excelOverview.sheets[this.participantsConfig.worksheet],t=/^[\w\s]+[0-9]+$/;return e.filter(e=>t.test(e)).map(e=>({column:e}))}}},re=ne,se=(i("ead0"),Object(u["a"])(re,Y,ee,!1,null,"20d3cd70",null)),oe=se.exports,ae=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("p",{staticStyle:{color:"red"}},[e._v(e._s(e.errorMessage))]),e.config.student&&e.config.courses?i("button",{on:{click:e.matchAndWrite}},[e._v(" Prioritäten auflösen ")]):e._e()])},ce=[];function le(e){if(e instanceof L)return"Teilnehmer '"+e.referrer+"' verweist auf nicht-existierende Aktivität mit id='"+e.id+"'";if(e instanceof F)switch(e.propertyName){case"priorities":return"Prioritäten von '"+e.entity.toString()+"' sind nicht eindeutig.";case"id":return"IDs der "+ue(e.entity)+" sind nicht eindeutig.";default:break}return"Keine Übersetzung für Fehler: "+e}function ue(e){return e instanceof E?"Teilnehmer":"Aktivitäten"}var fe={props:["config"],data(){return{errorMessage:""}},methods:{matchAndWrite(){this.errorMessage="",C(this.config.filename).then(e=>({workbook:e,config:this.config})).then(q).then(G).then(I).then(e=>this.$emit("matched",e)).catch(e=>{this.errorMessage=le(e)})}}},de=fe,he=Object(u["a"])(de,ae,ce,!1,null,null,null),pe=he.exports,ve=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.label?i("label",[e._v(e._s(e.label))]):e._e(),i("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedValue,expression:"selectedValue"}],on:{input:e.onSelected,change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedValue=t.target.multiple?i:i[0]}}},[i("option",[e._v(e._s(e.initialValue))]),e._l(e.values,(function(t){return i("option",[e._v(e._s(t))])}))],2)])},me=[],ge={props:["values","label"],methods:{onSelected(e){this.$emit("input",e.target.value),this.isPristine=!1},preSelect(){if(!this.label||!this.isPristine)return!1;const e=this.label.trim().toLowerCase();for(const t of this.values){const i=t.trim().toLowerCase();i.startsWith(e)&&(this.$emit("input",t),this.isPristine=!1,this.selectedValue=t)}}},data(){return{isPristine:!0,selectedValue:"Bitte auswählen",initialValue:"Bitte auswählen"}},mounted(){this.preSelect()},updated(){this.preSelect()}},_e=ge,be=Object(u["a"])(_e,ve,me,!1,null,null,null),we=be.exports,ye=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.result.courses?i("div",{attrs:{id:"results-root"}},[i("div",{attrs:{id:"results-config"}},[i("h2",[e._v("Resultat")]),i("label",{attrs:{for:"printShadows"}},[e._v("Schattenteilnehmer anzeigen")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.printShadows,expression:"printShadows"}],attrs:{id:"printShadows",type:"checkbox"},domProps:{checked:Array.isArray(e.printShadows)?e._i(e.printShadows,null)>-1:e.printShadows},on:{change:function(t){var i=e.printShadows,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,o=e._i(i,s);n.checked?o<0&&(e.printShadows=i.concat([s])):o>-1&&(e.printShadows=i.slice(0,o).concat(i.slice(o+1)))}else e.printShadows=r}}})]),i("div",{attrs:{id:"results-successful"}},[i("ul",e._l(e.result.courses,(function(t){return i("li",[i("h3",[e._v(e._s(t.name))]),i("table",[e._m(0,!0),i("tbody",e._l(t.students,(function(n){return i("tr",[i("td",[e._v(e._s(n.firstName))]),i("td",[e._v(e._s(n.name))]),i("td",[e._v(e._s(n.class))]),i("td",{staticClass:"priority-column"},[e._v(" "+e._s(n.priorities.indexOf(t.id)+1)+" ")])])})),0)]),e.printShadows?[i("h4",[e._v("Schattenteilnehmer")]),i("table",[e._m(1,!0),i("tbody",e._l(t.shadows,(function(t){return i("tr",[i("td",[e._v(e._s(t.student.firstName))]),i("td",[e._v(e._s(t.student.name))]),i("td",[e._v(e._s(t.student.class))]),i("td",[e._v(e._s(t.priority))]),i("td",[e._v(e._s(e.getReason(t)))])])})),0)])]:e._e()],2)})),0)]),i("div",{attrs:{id:"results-unassignable"}},[i("h3",[e._v("Nicht-zuweisbare Teilnehmer")]),i("table",[i("thead",[i("th"),i("th"),i("th"),e._l(e.numberOfPriorities(e.result.students),(function(t){return i("th",[e._v(" Priorität "+e._s(t)+" ")])}))],2),i("tbody",e._l(e.findUnmatched(e.result.students),(function(t){return i("tr",[i("td",[e._v(e._s(t.firstName))]),i("td",[e._v(e._s(t.name))]),i("td",[e._v(e._s(t.class))]),e._l(t.priorities,(function(t){return i("td",{staticClass:"priority-column"},[e._v(" "+e._s(t)+" ")])}))],2)})),0)])])]):e._e()},Ce=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("thead",[i("th"),i("th"),i("th"),i("th",[e._v("Priorität")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("thead",[i("th"),i("th"),i("th"),i("th",[e._v("Priorität")]),i("th",[e._v("Grund")])])}],ke=i("5a3a"),Oe=i.n(ke),xe={props:["result"],data(){return{printShadows:!1}},methods:{findUnmatched(e){return e.filter(e=>!e.matched)},numberOfPriorities(e){return Oe()(1,e[0].priorities.length+1)},getReason(e){const t=[];return e.wasAlreadyMatched?t.push("Bereits zugewiesen"):e.wasCourseFull&&t.push("Aktivität voll"),t.join(", ")}}},Pe=xe,Se=(i("650d"),Object(u["a"])(Pe,ye,Ce,!1,null,"a6d042de",null)),je=Se.exports;n["a"].component("am-multiselect",we);var $e={data(){return{excelOverview:null,matchConfig:{filename:null,courses:null,student:null},result:{courses:null}}},components:{"am-excel-reader":X,"am-activities-sheet-config":d,"am-participants-sheet-config":oe,"am-do-matching":pe,"am-result-printer":je},methods:{onOverviewLoaded(e){this.excelOverview=e,this.matchConfig.filename=e.filename},activitiesConfigCompleted(e){this.matchConfig.courses=e},participantsConfigCompleted(e){this.matchConfig.student=e},onMatched(e){this.result=e}}},Ae=$e,Ee=(i("7d00"),Object(u["a"])(Ae,r,s,!1,null,null,null)),Ne=Ee.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(Ne)}}).$mount("#app")},ead0:function(e,t,i){"use strict";var n=i("8dac"),r=i.n(n);r.a}});
//# sourceMappingURL=main.79dff3b6.js.map